## Terraform Generator (2)- Kubernetes
#

This project consists of the python script tfgen2k8s.py and template files. Through the Jinja2 templating engine a Terraform file is generated which can be used to spin up a kubernetes cluster. The cloudinit files which are injected in the CoreOS Container Linux Terraformed nodes are generated by tfgen2k8s.py.

### Dependencies

* OpenStack
* Terraform
* Python2.7
* Jinja2 python module
* git
* Openstack 'allow-all' security group for SNAT ports.

### Usage
```
usage: tfgen2k8s.py [-h] [--corepassword COREPASSWORD] [--username USERNAME]
                    [--projectname PROJECTNAME] [--clustername CLUSTERNAME]
                    [--subnetcidr SUBNETCIDR] [--calicocidr CALICOCIDR]
                    [--managers MANAGERS] [--workers WORKERS]
                    [--managerimageflavor MANAGERIMAGEFLAVOR]
                    [--workerimageflavor WORKERIMAGEFLAVOR]
                    [--dnsserver DNSSERVER] [--cloudprovider CLOUDPROVIDER]
                    [--k8sver K8SVER] [--flannelver FLANNELVER]
                    [--netoverlay NETOVERLAY] [--authmode AUTHMODE]
                    [--alphafeatures ALPHAFEATURES]
                    keypair floatingip1 floatingip2

positional arguments:
  keypair               Keypair ID
  floatingip1           Floatingip 1 for API calls
  floatingip2           Floatingip 2 for public access to cluster

optional arguments:
  -h, --help            show this help message and exit
  --corepassword COREPASSWORD
                        Password to authenticate with core user
  --username USERNAME   Openstack username - (OS_USERNAME environment
                        variable)
  --projectname PROJECTNAME
                        Openstack project Name - (OS_TENANT_NAME environment
                        variable)
  --clustername CLUSTERNAME
                        Clustername - (k8scluster)
  --subnetcidr SUBNETCIDR
                        Private subnet CIDR - (192.168.3.0/24)
  --calicocidr CALICOCIDR
                        Calico subnet CIDR - (10.244.0.0/16)
  --managers MANAGERS   Number of k8s managers - (3)
  --workers WORKERS     Number of k8s workers - (0)
  --managerimageflavor MANAGERIMAGEFLAVOR
                        Manager image flavor ID - (2004)
  --workerimageflavor WORKERIMAGEFLAVOR
                        Worker image flavor ID - (2008)
  --dnsserver DNSSERVER
                        DNS server - (8.8.8.8)
  --cloudprovider CLOUDPROVIDER
                        Cloud provider support - (openstack)
  --k8sver K8SVER       Hyperkube version - (v1.7.9_coreos.0)
  --flannelver FLANNELVER
                        Flannel image version - (v0.8.0)
  --netoverlay NETOVERLAY
                        Network overlay - (flannel)
  --authmode AUTHMODE   Authorization mode - (AlwaysAllow)
  --alphafeatures ALPHAFEATURES
                        enable alpha feature - (false)
```

### Features
* HA master k8s setup.
* PKI between etcd nodes and client to etcd cluster.
* PKI between k8s nodes.
* PKI from kubectl to k8s API.
* OpenStack provider for Storage through Cinder plugin.
* NodeRestriction admission control.
* RBAC authorization mode.
* Private network support
* Loadbalancing k8s managers through OpenStack (LBAAS).
* Loadbalancing k8s workers (up to first three) through OpenStack (LBAAS) for ingress.
* Etcd2 cluster inside k8s cluster.
* Flannel network overlay support.
* Calico network overlay support.
* All managers nodes are part of etcd2 cluster.

### Caveats
* Not all arguments are already implemented.
* Requires a minimum of 3 manager nodes.
